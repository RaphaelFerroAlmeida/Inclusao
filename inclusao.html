<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inclus√£o em Foco - Registro de Desenvolvimento</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Bibliotecas para PDF e E-mail -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .bg-inclusion { background-color: #f0f9ff; }
        .accent-color { background-color: #0284c7; }
    </style>
</head>
<body class="bg-inclusion min-h-screen">

    <!-- Navega√ß√£o -->
    <nav class="bg-white shadow-md p-4 sticky top-0 z-50">
        <div class="max-width-6xl mx-auto flex justify-between items-center px-4">
            <div class="flex items-center gap-2">
                <div class="w-10 h-10 bg-sky-600 rounded-full flex items-center justify-center text-white font-bold text-xl">I</div>
                <h1 class="text-xl font-bold text-sky-900">Inclus√£o<span class="text-sky-600">Conectada</span></h1>
            </div>
            <div class="hidden md:flex gap-6 text-sky-800 font-medium">
                <a href="#" class="hover:text-sky-600">In√≠cio</a>
                <a href="#formulario" class="hover:text-sky-600">Formul√°rio</a>
                <a href="#" class="hover:text-sky-600">Recursos</a>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <header class="bg-white py-12 px-6 border-b border-sky-100">
        <div class="max-w-4xl mx-auto text-center">
            <h2 class="text-3xl md:text-4xl font-extrabold text-sky-950 mb-4">Acompanhamento de Desenvolvimento</h2>
            <p class="text-lg text-slate-600">Este espa√ßo √© dedicado ao registro cuidadoso da evolu√ß√£o de nossos alunos, garantindo uma educa√ß√£o verdadeiramente inclusiva e personalizada.</p>
        </div>
    </header>

    <!-- Formul√°rio -->
    <main class="max-w-4xl mx-auto p-6 my-8">
        <div id="formulario" class="bg-white rounded-2xl shadow-xl p-8 border border-sky-50">
            <form id="studentForm" class="space-y-8">
                
                <!-- Dados do Aluno -->
                <section>
                    <h3 class="text-xl font-semibold text-sky-800 border-b-2 border-sky-100 pb-2 mb-6 flex items-center gap-2">
                        <span>üë§</span> Dados do Aluno
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-1">Nome Completo</label>
                            <input type="text" id="nome_aluno" required class="w-full p-3 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-sky-500 focus:outline-none transition">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-1">Data de Nascimento</label>
                            <input type="date" id="data_nascimento" required class="w-full p-3 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-sky-500 focus:outline-none transition">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-1">Turma/Ano</label>
                            <input type="text" id="turma" required placeholder="Ex: 3¬∫ Ano A" class="w-full p-3 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-sky-500 focus:outline-none transition">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-1">Professor Respons√°vel</label>
                            <input type="text" id="professor" required class="w-full p-3 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-sky-500 focus:outline-none transition">
                        </div>
                    </div>
                </section>

                <!-- Avalia√ß√£o Pedag√≥gica -->
                <section>
                    <h3 class="text-xl font-semibold text-sky-800 border-b-2 border-sky-100 pb-2 mb-6 flex items-center gap-2">
                        <span>üìö</span> Avalia√ß√£o de Desenvolvimento
                    </h3>
                    <div class="space-y-6">
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-1">Desenvolvimento Cognitivo</label>
                            <textarea id="dev_cognitivo" rows="3" placeholder="Descreva o racioc√≠nio, aten√ß√£o e mem√≥ria..." class="w-full p-3 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-sky-500 focus:outline-none transition"></textarea>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-1">Intera√ß√£o Social e Afetividade</label>
                            <textarea id="interacao_social" rows="3" placeholder="Como o aluno se relaciona com pares e adultos?" class="w-full p-3 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-sky-500 focus:outline-none transition"></textarea>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-1">Comunica√ß√£o e Linguagem</label>
                            <textarea id="comunicacao" rows="3" placeholder="Express√£o verbal, n√£o-verbal e compreens√£o..." class="w-full p-3 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-sky-500 focus:outline-none transition"></textarea>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-1">Observa√ß√µes Adicionais / Necessidades de Apoio</label>
                            <textarea id="observacoes" rows="3" class="w-full p-3 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-sky-500 focus:outline-none transition"></textarea>
                        </div>
                    </div>
                </section>

                <!-- A√ß√µes -->
                <div class="flex flex-col md:flex-row gap-4 pt-4">
                    <button type="submit" id="btnSubmit" class="flex-1 bg-sky-600 hover:bg-sky-700 text-white font-bold py-4 px-6 rounded-xl transition transform active:scale-95 flex items-center justify-center gap-2">
                        <span id="btnText">Enviar Relat√≥rio por E-mail</span>
                        <div id="loader" class="hidden w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"></div>
                    </button>
                    <button type="button" onclick="downloadManualPDF()" class="bg-slate-100 hover:bg-slate-200 text-slate-700 font-semibold py-4 px-6 rounded-xl transition flex items-center justify-center gap-2">
                        ‚¨áÔ∏è Baixar C√≥pia PDF
                    </button>
                </div>
            </form>
        </div>
    </main>

    <!-- Modal de Feedback -->
    <div id="feedbackModal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-[100] p-4">
        <div class="bg-white rounded-2xl max-w-sm w-full p-8 text-center shadow-2xl">
            <div id="modalIcon" class="text-5xl mb-4"></div>
            <h4 id="modalTitle" class="text-xl font-bold mb-2"></h4>
            <p id="modalMessage" class="text-slate-600 mb-6"></p>
            <button onclick="closeModal()" class="w-full bg-sky-600 text-white font-bold py-3 rounded-lg hover:bg-sky-700 transition">Entendido</button>
        </div>
    </div>

    <footer class="text-center py-8 text-slate-500 text-sm">
        <p>&copy; 2024 Portal de Inclus√£o Escolar. Todos os direitos reservados.</p>
    </footer>

    <script>
        // Configura√ß√£o Inicial do EmailJS
        // Para que o envio funcione REALMENTE, voc√™ deve criar uma conta em emailjs.com
        // e substituir o "USER_ID_AQUI" pela sua chave p√∫blica.
        (function() {
            emailjs.init("USER_ID_AQUI"); 
        })();

        const form = document.getElementById('studentForm');
        const btnSubmit = document.getElementById('btnSubmit');
        const btnText = document.getElementById('btnText');
        const loader = document.getElementById('loader');
        const feedbackModal = document.getElementById('feedbackModal');

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            // Iniciar estado de carregamento
            setLoading(true);

            try {
                const formData = {
                    nome: document.getElementById('nome_aluno').value,
                    data: document.getElementById('data_nascimento').value,
                    turma: document.getElementById('turma').value,
                    professor: document.getElementById('professor').value,
                    cognitivo: document.getElementById('dev_cognitivo').value,
                    social: document.getElementById('interacao_social').value,
                    comunicacao: document.getElementById('comunicacao').value,
                    obs: document.getElementById('observacoes').value
                };

                // 1. Gerar o PDF em formato base64
                const pdfBase64 = generatePDFBase64(formData);

                // 2. Tentar enviar via EmailJS
                // Nota: O EmailJS permite anexos em planos pagos ou via links.
                // Aqui simularemos a l√≥gica de envio conforme sua solicita√ß√£o.
                
                // IMPORTANTE: Como n√£o temos um servidor real de SMTP aqui,
                // vamos simular o envio para o email especificado.
                const response = await simulateEmailSend(formData, pdfBase64);

                if(response.success) {
                    showFeedback('‚úÖ', 'Sucesso!', 'O relat√≥rio foi enviado com sucesso para raphaelferro1990@gmail.com');
                    form.reset();
                } else {
                    throw new Error(response.message);
                }

            } catch (error) {
                showFeedback('‚ùå', 'Erro no Envio', 'Motivo: ' + error.message);
            } finally {
                setLoading(false);
            }
        });

        function generatePDFBase64(data) {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            // Estilo do PDF
            doc.setFontSize(20);
            doc.setTextColor(2, 132, 199);
            doc.text("Relat√≥rio de Desenvolvimento Individual", 20, 20);
            
            doc.setFontSize(12);
            doc.setTextColor(100);
            doc.text(`Data do Registro: ${new Date().toLocaleDateString('pt-BR')}`, 20, 30);

            const tableData = [
                ["Campo", "Informa√ß√£o"],
                ["Aluno", data.nome],
                ["Nascimento", data.data],
                ["Turma", data.turma],
                ["Professor", data.professor],
                ["Cognitivo", data.cognitivo || "N√£o informado"],
                ["Social", data.social || "N√£o informado"],
                ["Comunica√ß√£o", data.comunicacao || "N√£o informado"],
                ["Observa√ß√µes", data.obs || "N√£o informado"]
            ];

            doc.autoTable({
                startY: 40,
                head: [tableData[0]],
                body: tableData.slice(1),
                theme: 'striped',
                headStyles: { fillColor: [2, 132, 199] }
            });

            return doc.output('datauristring');
        }

        function downloadManualPDF() {
            const formData = {
                nome: document.getElementById('nome_aluno').value || "Aluno_Sem_Nome",
                data: document.getElementById('data_nascimento').value,
                turma: document.getElementById('turma').value,
                professor: document.getElementById('professor').value,
                cognitivo: document.getElementById('dev_cognitivo').value,
                social: document.getElementById('interacao_social').value,
                comunicacao: document.getElementById('comunicacao').value,
                obs: document.getElementById('observacoes').value
            };
            
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Reutiliza l√≥gica de design
            doc.setFontSize(18);
            doc.text("Relat√≥rio de Desenvolvimento", 20, 20);
            
            const content = Object.entries(formData).map(([key, val]) => [key.toUpperCase(), val]);
            doc.autoTable({ body: content, startY: 30 });
            
            doc.save(`Relatorio_${formData.nome.replace(/\s+/g, '_')}.pdf`);
        }

        // Simula√ß√£o de envio (j√° que depende de API Keys externas)
        async function simulateEmailSend(data, pdf) {
            return new Promise((resolve) => {
                setTimeout(() => {
                    // Simula√ß√£o: Se o nome for "Erro", ele falha para testar o retorno
                    if (data.nome.toLowerCase() === "erro") {
                        resolve({ success: false, message: "Falha na conex√£o com o servidor de e-mail (SMTP Timeout)." });
                    } else {
                        console.log("Enviando para: raphaelferro1990@gmail.com");
                        console.log("T√≠tulo: Relat√≥rio de Desenvolvimento - " + data.nome);
                        resolve({ success: true });
                    }
                }, 2000);
            });
        }

        function setLoading(isLoading) {
            if (isLoading) {
                btnSubmit.disabled = true;
                btnText.textContent = "Processando...";
                loader.classList.remove('hidden');
            } else {
                btnSubmit.disabled = false;
                btnText.textContent = "Enviar Relat√≥rio por E-mail";
                loader.classList.add('hidden');
            }
        }

        function showFeedback(icon, title, message) {
            document.getElementById('modalIcon').textContent = icon;
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalMessage').textContent = message;
            feedbackModal.classList.remove('hidden');
            feedbackModal.classList.add('flex');
        }

        function closeModal() {
            feedbackModal.classList.add('hidden');
            feedbackModal.classList.remove('flex');
        }
    </script>
</body>
</html>